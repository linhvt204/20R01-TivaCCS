/*******************************************************************************
 *  Name of files:  InitComparator.c
 *  Description:
 *
 * Linh Vu - vu.t.linh204.work@gmail.com
 * Freelance
 * October 2019
 * Built with CCS v.9.3

 ********************************************************************************/

#include <stdio.h>
#include <stdint.h>
#include <stdbool.h>
#include <user_init/InitInc.h>

void Init_Comparator0(void)
{
/*    ComparatorIntClear(COMP_BASE, 0);
    SysCtlPeripheralEnable(SYSCTL_PERIPH_COMP0);
    while (!SysCtlPeripheralReady(SYSCTL_PERIPH_COMP0))
    {
    }
    // Set ref&configure comparator
    ComparatorConfigure(
            COMP_BASE,
            0,
            COMP_TRIG_NONE | COMP_INT_BOTH | COMP_ASRCP_REF);
    ComparatorRefSet(COMP_BASE, COMP_REF_1_65V);
    // Delay for 10us as mentioned in datasheet
    //delay_us(15);
    SysCtlDelay(SysCtlClockGet() / 96);
    // Register & enable interrupt
    ComparatorIntRegister(COMP_BASE, 0U, &IntComparator0Handler);
    ComparatorIntEnable(COMP_BASE, 0);*/

    // Turn on peripheral
    SysCtlPeripheralEnable(SYSCTL_PERIPH_COMP0);
    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOC);

    // Wait for peripheral to be turn on
    while(!SysCtlPeripheralReady(SYSCTL_PERIPH_COMP0) ||
                !SysCtlPeripheralReady(SYSCTL_PERIPH_GPIOC));

    // Configuring the internal reference for the comparator to 1.65V
    ComparatorRefSet(COMP_BASE, COMP_REF_1_65V);

    // Configuring comparator
    ComparatorConfigure(COMP_BASE, 0, COMP_TRIG_NONE | COMP_INT_BOTH |
                        COMP_ASRCP_REF | COMP_OUTPUT_NORMAL);

    // Assigning pin for comparator
    GPIOPinTypeComparator(GPIO_PORTC_BASE, GPIO_PIN_7);

    // Enabling interrupts
    ComparatorIntRegister(COMP_BASE, 0, IntComparator0Handler);
    ComparatorIntEnable(COMP_BASE, 0);
    ComparatorIntClear(COMP_BASE, 0);

}

